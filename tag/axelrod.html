<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>axelrod - mojones.net</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




    <meta name="author" content="Martin Jones" />
    <meta name="keywords" content="axelrod" />

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="mojones.net" />
        <meta property="og:type" content="website"/>
        <meta property="og:title" content="mojones.net"/>
        <meta property="og:url" content=".."/>
        <meta property="og:description" content="mojones.net"/>


    <!-- Bootstrap -->
        <link rel="stylesheet" href="../theme/css/bootstrap.simplex.min.css" type="text/css"/>
    <link href="../theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="../theme/css/pygments/autumn.css" rel="stylesheet">
    <link rel="stylesheet" href="../theme/css/style.css" type="text/css"/>
        <link href="../static/custom.css" rel="stylesheet">

        <link href="../feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
              title="mojones.net ATOM Feed"/>




        <script src="../theme/js/jquery.min.js"></script>

        <script src="../theme/js/jquery.sidenotes.js"></script>

</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="../" class="navbar-brand">
mojones.net            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="../category/diy.html">Diy</a>
                        </li>
                        <li >
                            <a href="../category/programming.html">Programming</a>
                        </li>
                        <li >
                            <a href="../category/science.html">Science</a>
                        </li>
                        <li >
                            <a href="../category/tech.html">Tech</a>
                        </li>
                        <li >
                            <a href="../category/web.html">Web</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="../archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<style>
	#banner{
	    background-image:url("../images/header.jpg");
	}
</style>

<div id="banner">
	<div class="container">
		<div class="copy">
			<h1>mojones.net</h1>
		</div>
	</div>
</div><!-- End Banner -->
<div class="container">
    <div class="row">
        <div class="col-sm-9">
            <article>
                <h2><a href="../evolving-strategies-for-an-iterated-prisoners-dilemma-tournament.html">Evolving strategies for an Iterated Prisoner's Dilemma tournament</a></h2>
                    <div class="well well-sm">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-11-11T16:45:54.005438+00:00"> Wed 11 November 2015</time>
    </span>



        <span class="label label-default">Category</span>
        <a href="../category/programming.html">programming</a>


<span class="label label-default">Tags</span>
	<a href="../tag/python.html">python</a>
        /
	<a href="../tag/evolution.html">evolution</a>
        /
	<a href="../tag/axelrod.html">axelrod</a>
        /
	<a href="../tag/prisoners-dilemma.html">prisoners dilemma</a>
        /
	<a href="../tag/game-theory.html">game theory</a>
    
</footer><!-- /.post-info -->                    </div>
                <div class="summary"><p>Heads up to readers: this is a long article with lots of code samples and interactive charts. If you're reading on a mobile device, you might want to save this one until you can get to a wider screen! It may take a while to load all the charts. </p>
<h2>Introduction</h2>
<p>This is a longish post about using a simple evolutionary algorithm in Python to create a strategy for playing the famous Prisoner's Dilemma game (actually, the version known as Iterated Prisoner's Dilemma, hereafter referred to as IPD). If you're not already familiar with the Prisoner's Dilemma, take a look at the first bit of <a href="https://en.wikipedia.org/wiki/Prisoner%27s_dilemma">the Wikipedia page</a> and the section on <a href="https://en.wikipedia.org/wiki/Prisoner%27s_dilemma#The_iterated_prisoners.27_dilemma">Iterated Prisoner's Dilemma</a>. You might also want to watch <a href="https://www.youtube.com/watch?v=t9Lo2fgxWHw">this short video</a> and take a look at <a href="https://egtheory.wordpress.com/2015/03/02/ipd/">this blog post</a>. </p>
<p>The impetus for this project was hearing about (and then working on a code sprint for) the <a href="https://github.com/Axelrod-Python/Axelrod">Axelrod library</a> at PyConUk 2015. Axelrod is a Python library which provides a framework for running IPD tournaments. This makes it very easy to play around with different strategies. </p>
<p>Strategies are implemented as classes which have a single method, <code>strategy()</code> which takes as its argument an opponent object, and returns an action. Actions are represented by <code>C</code> for cooperate and <code>D</code> for defect. For example, here's the famous <strong>Tit for tat</strong> strategy that won the original Axelrod tournament in 1980, which can be summarized as "co-operate on the first turn, then copy the opponent's last action":</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This is the actual strategy&quot;&quot;&quot;</span>
    <span class="c"># First move</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">C</span>
    <span class="c"># React to the opponent&#39;s last move</span>
    <span class="k">if</span> <span class="n">opponent</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">D</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">D</span>
    <span class="k">return</span> <span class="n">C</span>
</pre></div>


<aside>
<p>*So-called because it appears to cooperate for a long time, then defects near the end of the match.</p>
</aside>
<p>As we can see, the player has access to its own history through the <code>self.history</code> variable and to the opponent's history though the <code>opponent.history</code> variable. Players can implement more sophisticated strategies by examining these variables, and they also have access to the length of the match. For example, when I first encountered the Axelrod library the winning strategy was called <strong>DoubleCrosser</strong>* and worked like this (edited slightly for clarity):</p>
<div class="highlight"><pre> <span class="k">def</span> <span class="nf">strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent</span><span class="p">):</span>

    <span class="c"># if there is no history, then this is the first turn, so cooperate</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">opponent</span><span class="o">.</span><span class="n">history</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">C</span>

    <span class="c"># if this is either the last or second-to-last turn, defect</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opponent</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tournament_attributes</span><span class="p">[</span><span class="s">&#39;length&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">3</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">D</span>

    <span class="c"># if the opponent did not defect on any of the first six turns,</span>
    <span class="c"># and we are not in the last 20 turns, cooperate</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opponent</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">opponent</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">D</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">opponent</span><span class="o">.</span><span class="n">history</span><span class="p">[:</span><span class="mi">7</span><span class="p">]:</span>
                 <span class="k">return</span> <span class="n">C</span>

    <span class="c"># if the total number of defections by the opponent is </span>
    <span class="c"># greater than three, always defect</span>
    <span class="k">if</span> <span class="n">opponent</span><span class="o">.</span><span class="n">defections</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">D</span>

    <span class="c"># failsafe; if none of the other conditions are true,</span>
    <span class="c"># cooperate</span>
    <span class="k">return</span> <span class="n">C</span>
</pre></div>


<aside>*This is because the best strategies mostly score through mutual cooperation, which scores 3 points</aside>

<p>The library takes care of matching up players in pairwise combinations, running the tournament for a given number of turns, and keeping score. For the sake of convenience, scores are usually expressed as average score per turn. The best possible outcome for a given turn is that a player defects and their opponent cooperates giving a score of 5 in the standard payoff matrix, so that's the theoretical best average score per turn. The best strategies in the Axelrod library currently score around 3*. Here's a chart showing the ten best strategies, plus <strong>Tit for Tat</strong>, <strong>Cooperator</strong>, and <strong>Defector</strong> for reference:</p>
<aside>
<p>Spoiler alert: these strategies are going to get soundly thrashed by the end of this article :-)</p>
</aside>
<p><img alt="fig1" src="/images/best_10_strategies.png" /></p>
<p>The reason that we're looking at a box plot here is that some of the strategies are <strong>stochastic</strong>, i.e. there's some random variation in the action they take. When calculating the scores, the Axelrod library takes care of running the tournament multiple times (100 by default) to get an average score for each strategy. </p>
<hr />
<h2>Using lookup tables to define a strategy</h2>
<p>Many of the strategies in the Axelrod library choose their action based on what happened on the previous turn (or possibly earlier in the history). <strong>Tit for Tat</strong> is a good example; its action on a given turn depends entirely on the opponent's action on the previous one. We can think of this as a lookup table:</p>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>Opponent's previous action</th>
      <th>My action</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Cooperate</td>
      <td>Cooperate</td>
    </tr>
    <tr>
      <td>Defect</td>
      <td>Defect</td>
    </tr>
  </tbody>
</table>

<p>or, in Python, as a dict where the keys are opponent's previous action, and the values are my action:</p>
<div class="highlight"><pre><span class="n">lookup_table</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;C&#39;</span> <span class="p">:</span> <span class="s">&#39;C&#39;</span><span class="p">,</span>
    <span class="s">&#39;D&#39;</span> <span class="p">:</span> <span class="s">&#39;D&#39;</span>
<span class="p">}</span>
</pre></div>


<p>If we wanted to write a strategy that used this lookup table to decide what action to take, we could just grab the opponent's last action from its history like this:</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">strategy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opponent</span><span class="p">):</span>
    <span class="n">lookup_table</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s">&#39;C&#39;</span> <span class="p">:</span> <span class="s">&#39;C&#39;</span><span class="p">,</span>
            <span class="s">&#39;D&#39;</span> <span class="p">:</span> <span class="s">&#39;D&#39;</span>
        <span class="p">}</span>

    <span class="c"># First move</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">history</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">C</span>

    <span class="c"># Get the opponent&#39;s last action</span>
    <span class="n">last_action</span> <span class="o">=</span> <span class="n">opponent</span><span class="o">.</span><span class="n">history</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="c"># Use it to look up my action</span>
    <span class="n">my_action</span> <span class="o">=</span> <span class="n">lookup_table</span><span class="p">[</span><span class="n">last_action</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">my_action</span>
</pre></div>


<p>Notice that we still need a special case for the first turn; obviously if there is no history then we can't use the lookup table!</p>
<p>The nice thing about expressing a strategy in this was is that we can get different behaviours by changing the lookup table and leaving the strategy code exactly the same. In other words, the strategy is completely determined by the lookup table. For our current example, this isn't very exciting - given that there are only two possibilities for the dict key there are only three other strategies that we can describe: <strong>Cooperator</strong>:</p>
<div class="highlight"><pre><span class="c"># always cooperate</span>
<span class="n">lookup_table</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;C&#39;</span> <span class="p">:</span> <span class="s">&#39;C&#39;</span><span class="p">,</span>
        <span class="s">&#39;D&#39;</span> <span class="p">:</span> <span class="s">&#39;C&#39;</span>
    <span class="p">}</span>
</pre></div>


<p>, <strong>Defector</strong>:</p>
<div class="highlight"><pre><span class="c"># always defect</span>
<span class="n">lookup_table</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;C&#39;</span> <span class="p">:</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
        <span class="s">&#39;D&#39;</span> <span class="p">:</span> <span class="s">&#39;D&#39;</span>
    <span class="p">}</span>
</pre></div>


<p>, and <strong>Inverse Tit for Tat</strong>, which always does the opposite of the opponent's last action:</p>
<div class="highlight"><pre><span class="c"># do the opposite of my opponent&#39;s last action</span>
<span class="n">lookup_table</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;C&#39;</span> <span class="p">:</span> <span class="s">&#39;D&#39;</span><span class="p">,</span>
        <span class="s">&#39;D ...</span></pre></div>
                        <a class="btn btn-default btn-xs" href="../evolving-strategies-for-an-iterated-prisoners-dilemma-tournament.html">more ...</a>
    
                </div>
            </article>
            <hr/>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="/images/avatar.jpg"/>
        </p>
    <p>
        <strong>About Martin Jones</strong><br/>
        
Coding, writing and teaching<br>

<h3>My books</h3>

<a href="http://www.amazon.com/Python-Biologists-complete-programming-beginners/dp/1492346136/">
    <h5>Python for Biologists</h5>
    <img src="/images/p4b.png"> 
</a>

<a href="http://www.amazon.com/Advanced-Python-Biologists-Martin-Jones/dp/1495244377/">
    <h5>Advanced Python for Biologists</h5>
    <img src="/images/ap4b.png"> 
</a>

<a href="http://www.amazon.com/Python-complete-beginners-friendly-experience/dp/1514376989/">
    <h5>Python for complete beginners</h5>
    <img src="/images/p4begin.png"> 
</a>


    </p>
</div>
<section class="well well-sm">



    <ul class="list-group list-group-flush">
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://pythonforbiologists.com" target="_blank">
                Python for Biologists
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://www.amazon.com/gp/search/ref=sr_adv_b/?search-alias=stripbooks&unfiltered=1&field-keywords=&field-author=&field-title=&field-isbn=1514376989+%7C+1492346136+%7C+1495244377&field-publisher=&node=&field-p_n_condition-type=&p_n_feature_browse-bin=&field-subject=&field-language=&field-dateop=During&field-datemod=&field-dateyear=&sort=relevanceexprank&Adv-Srch-Books-Submit.x=20&Adv-Srch-Books-Submit.y=19" target="_blank">
                My Python books
            </a>
        </li>
      </ul>
    </li>


            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="../evolving-strategies-for-an-iterated-prisoners-dilemma-tournament.html">
                            Evolving strategies for an Iterated Prisoner's Dilemma tournament
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="../"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="../category/diy.html">
                            <i class="fa fa-folder-open fa-lg"></i> diy
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="../category/programming.html">
                            <i class="fa fa-folder-open fa-lg"></i> programming
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="../category/science.html">
                            <i class="fa fa-folder-open fa-lg"></i> science
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="../category/tech.html">
                            <i class="fa fa-folder-open fa-lg"></i> tech
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="../category/web.html">
                            <i class="fa fa-folder-open fa-lg"></i> web
                        </a>
                    </li>
                </ul>
            </li>




    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/mojones">@mojones</a> on GitHub
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2015 Martin Jones
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>


<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="../theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="../theme/js/respond.min.js"></script>

    <script src="../theme/js/bodypadding.js"></script>
    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = '../theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'mojones',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="../theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'mojonesnet'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->
    <!-- Google Analytics -->
    <script type="text/javascript">

        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-2758363-36']);
        _gaq.push(['_trackPageview']);

        (function () {
            var ga = document.createElement('script');
            ga.type = 'text/javascript';
            ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(ga, s);
        })();
    </script>
    <!-- End Google Analytics Code -->

</body>
</html>