<!DOCTYPE html>
<html lang="en" prefix="og: http://ogp.me/ns# fb: https://www.facebook.com/2008/fbml">
<head>
    <title>web - mojones.net</title>
    <!-- Using the latest rendering mode for IE -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">




    <meta name="author" content="Martin Jones" />
    <meta name="keywords" content="web" />

    <!-- Open Graph tags -->
        <meta property="og:site_name" content="mojones.net" />
        <meta property="og:type" content="website"/>
        <meta property="og:title" content="mojones.net"/>
        <meta property="og:url" content="http://mojones.net"/>
        <meta property="og:description" content="mojones.net"/>


    <!-- Bootstrap -->
        <link rel="stylesheet" href="http://mojones.net/theme/css/bootstrap.simplex.min.css" type="text/css"/>
    <link href="http://mojones.net/theme/css/font-awesome.min.css" rel="stylesheet">

    <link href="http://mojones.net/theme/css/pygments/solarizedlight.css" rel="stylesheet">
    <link rel="stylesheet" href="http://mojones.net/theme/css/style.css" type="text/css"/>
        <link href="http://mojones.net/static/custom.css" rel="stylesheet">





</head>
<body>

<div class="navbar navbar-default navbar-fixed-top" role="navigation">
	<div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a href="http://mojones.net/" class="navbar-brand">
mojones.net            </a>
        </div>
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                        <li >
                            <a href="http://mojones.net/category/diy.html">Diy</a>
                        </li>
                        <li >
                            <a href="http://mojones.net/category/programming.html">Programming</a>
                        </li>
                        <li >
                            <a href="http://mojones.net/category/science.html">Science</a>
                        </li>
                        <li >
                            <a href="http://mojones.net/category/tech.html">Tech</a>
                        </li>
                        <li class="active">
                            <a href="http://mojones.net/category/web.html">Web</a>
                        </li>
            </ul>
            <ul class="nav navbar-nav navbar-right">
              <li><a href="http://mojones.net/archives.html"><i class="fa fa-th-list"></i><span class="icon-label">Archives</span></a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
</div> <!-- /.navbar -->
<!-- Banner -->
<style>
	#banner{
	    background-image:url("http://mojones.net/images/header.jpg");
	}
</style>

<div id="banner">
	<div class="container-fluid">
		<div class="copy">
			<h1>mojones.net</h1>
		</div>
	</div>
</div><!-- End Banner -->
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-9">
            <article>
                <h2><a href="http://mojones.net/301-permanent-redirect-with-tomcat.html">301 permanent redirect with Tomcat</a></h2>
                    <div class="well well-sm">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-11-04T16:44:12.561255+00:00"> Wed 04 November 2015</time>
    </span>



        <span class="label label-default">Category</span>
        <a href="http://mojones.net/category/web.html">web</a>


<span class="label label-default">Tags</span>
	<a href="http://mojones.net/tag/java.html">java</a>
        /
	<a href="http://mojones.net/tag/javascript.html">javascript</a>
        /
	<a href="http://mojones.net/tag/seo.html">seo</a>
        /
	<a href="http://mojones.net/tag/servlets.html">servlets</a>
        /
	<a href="http://mojones.net/tag/http.html">http</a>
    
</footer><!-- /.post-info -->                    </div>
                <div class="summary"><p>Whenever I set up a new site, I want to make sure that example.com points to www.example.com. This is basic SEO – check out <a href="https://web.archive.org/web/20100727065239/http://www.kalzumeus.com/2007/10/07/dont-make-my-really-elementary-seo-mistake/">this link</a> for a quick explanation. I know that this is trivial to do in Apache, but for the sake of simplicity I wanted to use Tomcat only as my web server.</p>
<p>After much searching around, it became clear that (1) Tomcat can’t do this and (2) I’m not the only person with this problem. The solution is a Java servlet filter called <a href="https://web.archive.org/web/20100727065239/http://tuckey.org/urlrewrite/">URLRewriteFilter</a>. It does the job perfectly, but it took me a while to get it set up right, so here’s a quick howto for anyone else in the same position.</p>
<p>The instructions on the project’s homepage will get you most of the way there. You unzip the contents of the binary download (a single .jar and a config file) into your context’s directory, then add a servlet mapping to make sure that UrlRewriteFilter gets to handle all requests. Make sure that the UrlRewriteFilter servlet mapping goes at the top of the web.xml file, to ensure that the filter gets to see HTTP requests before any other servlet.</p>
<p>The tricky part is getting the config file <code>WEB-INF/urlrewrite.xml</code> just right, so here’s the configuration that worked for me:</p>
<div class="highlight"><pre><span class="nt">&lt;urlrewrite&gt;</span>
<span class="nt">&lt;rule&gt;</span>
    <span class="nt">&lt;name&gt;</span>seo redirect<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;condition</span> <span class="na">name=</span><span class="s">&quot;host&quot;</span> <span class="na">operator=</span><span class="s">&quot;notequal&quot;</span><span class="nt">&gt;</span>^www\.example\.com<span class="nt">&lt;/condition&gt;</span>
    <span class="nt">&lt;from&gt;</span>^/(.*)<span class="nt">&lt;/from&gt;</span>
    <span class="nt">&lt;to</span> <span class="na">type=</span><span class="s">&quot;permanent-redirect&quot;</span> <span class="na">last=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>http://www.example.com/$1<span class="nt">&lt;/to&gt;</span>
<span class="nt">&lt;/rule&gt;</span>
<span class="nt">&lt;/urlrewrite&gt;</span>
</pre></div>


<p>The <code>condition</code> element tells us that we want to trigger this rule when the HTTP request host header is not equal to <code>www.example.com</code>. Because it’s a regular expression, we escape the dots with backslashes (and use a start-anchor for good measure). The <code>from</code> element uses parentheses to capture the whole of the path the the resource that’s being asked for, minus the starting forward slash. Of course, if the request is just for <code>example.com</code> (probably the most common scenario) then this will be empty. The captured value is then used in the to element to construct that path for the redirect. So <code>example.com/tour.jsp</code> should redirect to <code>www.example.com/tour.jsp</code>.</p>
<h2>Update</h2>
<p>A quick update to mention a gotcha that I ran into; if you set up UrlRewriteFilter as described above then it will redirect you if you try to access your website on your development machine by going to <code>localhost:8080</code>. This can lead to very frustrating scenarios involving repeatedly hitting F5 while muttering “why aren’t you showing my changes, dammit?” and failing to notice that the address bar reads <code>www.mywebsite.com</code>. Because UrlRewriteFilter lets you have multiple conditions, it’s quite easy to get the correct behaviour:</p>
<div class="highlight"><pre><span class="nt">&lt;urlrewrite&gt;</span>
<span class="nt">&lt;rule&gt;</span>
    <span class="nt">&lt;name&gt;</span>seo redirect<span class="nt">&lt;/name&gt;</span>
    <span class="nt">&lt;condition</span> <span class="na">name=</span><span class="s">&quot;host&quot;</span> <span class="na">operator=</span><span class="s">&quot;notequal&quot;</span><span class="nt">&gt;</span>^www\.example\.com<span class="nt">&lt;/condition&gt;</span>
    <span class="nt">&lt;condition</span> <span class="na">name=</span><span class="s">&quot;host&quot;</span> <span class="na">operator=</span><span class="s">&quot;notequal&quot;</span><span class="nt">&gt;</span>^localhost<span class="nt">&lt;/condition&gt;</span>
    <span class="nt">&lt;from&gt;</span>^/(.*)<span class="nt">&lt;/from&gt;</span>
    <span class="nt">&lt;to</span> <span class="na">type=</span><span class="s">&quot;permanent-redirect&quot;</span> <span class="na">last=</span><span class="s">&quot;true&quot;</span><span class="nt">&gt;</span>http://www.example.com/$1<span class="nt">&lt;/to&gt;</span>
<span class="nt">&lt;/rule&gt;</span>
<span class="nt">&lt;/urlrewrite&gt;</span>
</pre></div>
                        <a class="btn btn-default btn-xs" href="http://mojones.net/301-permanent-redirect-with-tomcat.html">more ...</a>
    
                </div>
            </article>
            <hr/>
            <article>
                <h2><a href="http://mojones.net/how-to-fix-an-infinite-301-redirect-loop-in-wordpress.html">How to fix an infinite 301 redirect loop in WordPress</a></h2>
                    <div class="well well-sm">
<footer class="post-info">
    <span class="label label-default">Date</span>
    <span class="published">
        <i class="fa fa-calendar"></i><time datetime="2015-11-04T16:44:12.561255+00:00"> Wed 04 November 2015</time>
    </span>



        <span class="label label-default">Category</span>
        <a href="http://mojones.net/category/web.html">web</a>


<span class="label label-default">Tags</span>
	<a href="http://mojones.net/tag/wordpress.html">wordpress</a>
        /
	<a href="http://mojones.net/tag/web.html">web</a>
        /
	<a href="http://mojones.net/tag/config.html">config</a>
    
</footer><!-- /.post-info -->                    </div>
                <div class="summary"><p>I just ran into this problem today; thought I should post the solution in case anybody else finds themselves in the same boat.</p>
<p>I moved a WordPress blog from one server to another which was running lighttpd with a blanket 301 redirect to from www to non-www URLs. When I fired up a browser to test it, I got the dreaded “this website is responding in a way that will never resolve” message. A quick look at the lighttpd logs confirmed that I was bouncing from <strong>www.example.com</strong> to <strong>example.com</strong> then back to <strong>www.example.com</strong>.</p>
<p>I expected the first redirect but not the second, and checking in my lighttpd conf showed no rule that could possibly be triggering it. Thinking maybe I had left a redirection plugin running, I logged on the blog (by temporarily disabling the redirect rules) and checked, but couldn’t find anything.</p>
<p>Turns out that WordPress itself is capable of generating 301 redirects according to the “Blog URL” field in the General settings page. If the URL is set to <strong>http://www.example.com</strong> and a request comes in for <strong>http://example.com/some/page</strong>, then WordPress will automatically respond with a 301 redirect to <strong>http://www.example.com/some/page</strong> (which in my case, would get caught by my lighttpd rule and bounced back to the original request URL, and so on).</p>
<p>Moral of the story: make sure that your WordPress URL settings and any manual redirection you are carrying out are in agreement as to what the ‘correct’ URL should be!</p>
                        <a class="btn btn-default btn-xs" href="http://mojones.net/how-to-fix-an-infinite-301-redirect-loop-in-wordpress.html">more ...</a>
    
                </div>
            </article>
            <hr/>

        </div>
        <div class="col-sm-3" id="sidebar">
            <aside>
<div id="aboutme">
        <p>
            <img width="100%" class="img-thumbnail" src="images/avatar.jpg"/>
        </p>
    <p>
        <strong>About Martin Jones</strong><br/>
        Coding, writing and teaching
    </p>
</div>
<section class="well well-sm">



    <ul class="list-group list-group-flush">
    <li class="list-group-item"><h4><i class="fa fa-external-link-square fa-lg"></i><span class="icon-label">Links</span></h4>
      <ul class="list-group" id="links">
        <li class="list-group-item">
            <a href="http://pythonforbiologists.com" target="_blank">
                Python for Biologists
            </a>
        </li>
        <li class="list-group-item">
            <a href="http://www.amazon.com/gp/search/ref=sr_adv_b/?search-alias=stripbooks&unfiltered=1&field-keywords=&field-author=&field-title=&field-isbn=1514376989+%7C+1492346136+%7C+1495244377&field-publisher=&node=&field-p_n_condition-type=&p_n_feature_browse-bin=&field-subject=&field-language=&field-dateop=During&field-datemod=&field-dateyear=&sort=relevanceexprank&Adv-Srch-Books-Submit.x=20&Adv-Srch-Books-Submit.y=19" target="_blank">
                My Python books
            </a>
        </li>
      </ul>
    </li>


            <li class="list-group-item"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Recent Posts</span></h4>
                <ul class="list-group" id="recentposts">
                    <li class="list-group-item">
                        <a href="http://mojones.net/301-permanent-redirect-with-tomcat.html">
                            301 permanent redirect with Tomcat
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://mojones.net/how-to-fix-an-infinite-301-redirect-loop-in-wordpress.html">
                            How to fix an infinite 301 redirect loop in WordPress
                        </a>
                    </li>
                </ul>
            </li>

            <li class="list-group-item"><a href="http://mojones.net/"><h4><i class="fa fa-home fa-lg"></i><span class="icon-label">Categories</span></h4></a>
                <ul class="list-group" id="categories">
                    <li class="list-group-item">
                        <a href="http://mojones.net/category/diy.html">
                            <i class="fa fa-folder-open fa-lg"></i> diy
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://mojones.net/category/programming.html">
                            <i class="fa fa-folder-open fa-lg"></i> programming
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://mojones.net/category/science.html">
                            <i class="fa fa-folder-open fa-lg"></i> science
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://mojones.net/category/tech.html">
                            <i class="fa fa-folder-open fa-lg"></i> tech
                        </a>
                    </li>
                    <li class="list-group-item">
                        <a href="http://mojones.net/category/web.html">
                            <i class="fa fa-folder-open fa-lg"></i> web
                        </a>
                    </li>
                </ul>
            </li>




    <li class="list-group-item"><h4><i class="fa fa-github fa-lg"></i><span class="icon-label">GitHub Repos</span></h4>
        <div id="gh_repos">
            <p class="list-group-item">Status updating...</p>
        </div>
            <a href="https://github.com/mojones">@mojones</a> on GitHub
    </li>
    </ul>
</section>
            </aside>
        </div>
    </div>
</div>
<footer>
   <div class="container-fluid">
      <hr>
      <div class="row">
         <div class="col-xs-10">&copy; 2015 Martin Jones
            &middot; Powered by <a href="https://github.com/DandyDev/pelican-bootstrap3" target="_blank">pelican-bootstrap3</a>,
            <a href="http://docs.getpelican.com/" target="_blank">Pelican</a>,
            <a href="http://getbootstrap.com" target="_blank">Bootstrap</a>         </div>
         <div class="col-xs-2"><p class="pull-right"><i class="fa fa-arrow-up"></i> <a href="#">Back to top</a></p></div>
      </div>
   </div>
</footer>
<script src="http://mojones.net/theme/js/jquery.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<script src="http://mojones.net/theme/js/bootstrap.min.js"></script>

<!-- Enable responsive features in IE8 with Respond.js (https://github.com/scottjehl/Respond) -->
<script src="http://mojones.net/theme/js/respond.min.js"></script>

    <script src="http://mojones.net/theme/js/bodypadding.js"></script>
    <!-- GitHub JS -->
    <script type="text/javascript">
        $(document).ready(function () {
            if (!window.jXHR) {
                var jxhr = document.createElement('script');
                jxhr.type = 'text/javascript';
                jxhr.src = 'http://mojones.net/theme/js/jXHR.js';
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(jxhr, s);
            }

            github.showRepos({
                user: 'mojones',
                count: 5,
                skip_forks: false,
                target: '#gh_repos'
            });
        });
    </script>
    <script src="http://mojones.net/theme/js/github.js" type="text/javascript"></script>
    <!-- End GitHub JS Code -->
    <!-- Disqus -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'mojonesnet'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function () {
            var s = document.createElement('script');
            s.async = true;
            s.type = 'text/javascript';
            s.src = '//' + disqus_shortname + '.disqus.com/count.js';
            (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
        }());
    </script>
    <!-- End Disqus Code -->

</body>
</html>